<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–∑–∞—â–∏—â–µ–Ω–æ)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .password-form {
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .password-form input {
            padding: 10px;
            margin: 10px;
            width: 200px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .password-form button {
            padding: 10px 20px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .password-form button:hover {
            background: #1d4ed8;
        }
        .error-message {
            color: #ef4444;
            margin-top: 10px;
            font-size: 14px;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 10px;
        }
        h3 {
            color: #2563eb;
            margin-top: 30px;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        button:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        input, select {
            padding: 8px 12px;
            margin: 5px;
            border: 1px solid #d1d5db;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
            max-width: 300px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
        }
        pre {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .info { color: #6b7280; }
        .status-box {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 5px;
        }
        .subscription-item {
            border-bottom: 1px solid #e5e7eb;
            padding: 10px 0;
            font-size: 12px;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .input-group {
            background: #f9fafb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .badge {
            background: #2563eb;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        .section-divider {
            margin-top: 40px;
            border-top: 2px solid #2563eb;
            padding-top: 20px;
        }
        .section-title {
            color: #2563eb;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .logout-btn {
            background: #dc2626;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .logout-btn:hover {
            background: #b91c1c;
        }
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <script>
        // ========== –ó–ê–©–ò–¢–ê –ü–ê–†–û–õ–ï–ú ==========
        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å –∑–¥–µ—Å—å
        const DEV_PASSWORD = 'apsod2026'; // ‚Üê –ò–ó–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô –ü–ê–†–û–õ–¨!
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–æ—Å—Ç—É–ø–∞
        function checkAccess() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ localStorage (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)
            if (localStorage.getItem('dev_access') === DEV_PASSWORD) {
                return true;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ sessionStorage (–¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞)
            if (sessionStorage.getItem('dev_temp_access') === DEV_PASSWORD) {
                return true;
            }
            
            return false;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
        function showLoginForm() {
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <div class="password-form">
                    <h2>üîí –î–æ—Å—Ç—É–ø –∫ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</h2>
                    <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è:</p>
                    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" />
                    <br />
                    <button onclick="verifyPassword()">–í–æ–π—Ç–∏</button>
                    <div class="error-message" id="passwordError"></div>
                    <p style="margin-top: 20px; font-size: 12px; color: #666;">
                        * –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤
                    </p>
                    <p style="font-size: 11px; color: #999;">
                        –ü–∞—Ä–æ–ª—å: ${DEV_PASSWORD}
                    </p>
                </div>
            `;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
        window.verifyPassword = function() {
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('passwordError');
            
            if (password === DEV_PASSWORD) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage (–¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–∫–∏)
                sessionStorage.setItem('dev_temp_access', password);
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                loadMainContent();
            } else {
                errorDiv.textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
            }
        };
        
        // –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        window.rememberMe = function() {
            const password = document.getElementById('password').value;
            if (password === DEV_PASSWORD) {
                localStorage.setItem('dev_access', password);
                sessionStorage.setItem('dev_temp_access', password);
                loadMainContent();
            }
        };
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        window.logout = function() {
            localStorage.removeItem('dev_access');
            sessionStorage.removeItem('dev_temp_access');
            showLoginForm();
        };
        
        // ========== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ ==========
        function loadMainContent() {
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <div class="container">
                    <div class="header-bar">
                        <span>üîì –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω</span>
                        <button onclick="logout()" class="logout-btn">–í—ã–π—Ç–∏</button>
                    </div>

                    <h1>üîî –¢–µ—Å—Ç API —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π APSOD</h1>
                    
                    <!-- –°–µ–∫—Ü–∏—è 1: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ -->
                    <div class="section-title">üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏</div>
                    <div class="button-group">
                        <button onclick="testSubscribe()" id="subscribeBtn" style="background: #2563eb;">üìù 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É</button>
                        <button onclick="testGetSubscriptions()" id="getBtn" style="background: #059669;">üìã 2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫</button>
                        <button onclick="testDeleteAll()" id="deleteBtn" style="background: #dc2626;">üóëÔ∏è 3. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏</button>
                    </div>

                    <!-- –°–µ–∫—Ü–∏—è 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
                    <div class="section-divider">
                        <div class="section-title">üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
                        
                        <div class="input-group">
                            <div style="margin-bottom: 15px;">
                                <input type="text" id="notifyTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" value="–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç APSOD" style="width: 250px;">
                                <span class="badge">–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <input type="text" id="notifyBody" placeholder="–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" value="–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ" style="width: 350px;">
                                <span class="badge">–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <input type="text" id="notifyUrl" placeholder="URL –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" value="/blog" style="width: 300px;">
                                <span class="badge">–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <input type="text" id="notifyIcon" placeholder="–ò–∫–æ–Ω–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" value="/icons/icon-192x192.png" style="width: 300px;">
                            </div>
                        </div>

                        <div class="button-group">
                            <button onclick="testSendNotification()" id="sendBtn" style="background: #10b981;">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–µ</button>
                            <button onclick="testSendAdvanced()" id="sendAdvancedBtn" style="background: #8b5cf6;">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ</button>
                            <button onclick="testSendToAll()" id="sendAllBtn" style="background: #f59e0b;">üì¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º</button>
                        </div>
                    </div>

                    <!-- –°–µ–∫—Ü–∏—è 3: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç—å—è—Ö -->
                    <div class="section-divider">
                        <div class="section-title">üìù –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç—å—è—Ö</div>
                        
                        <div class="input-group">
                            <div style="margin-bottom: 15px;">
                                <select id="postSlug" style="padding: 8px; margin: 5px; width: 400px;">
                                    <option value="">üìö –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—å—é...</option>
                                    <option value="gpt-5-revolution-web-development">ü§ñ GPT-5 –∏ —Ä–µ–≤–æ–ª—é—Ü–∏—è –≤ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</option>
                                    <option value="neural-interfaces-web">üß† –ù–µ–π—Ä–æ–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ –≤–µ–±–µ</option>
                                    <option value="ai-code-assistants-2026">üë®‚Äçüíª AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞</option>
                                    <option value="webassembly-2026">‚ö° WebAssembly 2.0</option>
                                    <option value="ai-personalization-2026">üéØ –ì–∏–ø–µ—Ä–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ AI</option>
                                    <option value="quantum-web">‚öõÔ∏è –ö–≤–∞–Ω—Ç–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –≤–µ–±</option>
                                    <option value="serverless-ai">‚òÅÔ∏è Serverless AI</option>
                                    <option value="edge-computing-2026">üåê Edge computing</option>
                                    <option value="ai-ux-design">üé® AI –≤ UX/UI –¥–∏–∑–∞–π–Ω–µ</option>
                                    <option value="web3-2026">üîó Web3 –∏ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è</option>
                                    <option value="pochemu-sait-litso-kompanii">üè¢ –ü–æ—á–µ–º—É —Å–∞–π—Ç ‚Äî —ç—Ç–æ –ª–∏—Ü–æ –∫–æ–º–ø–∞–Ω–∏–∏</option>
                                    <option value="preimushestva-saita-v-sovremennom-mire">üìà 7 –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ —Å–∞–π—Ç–∞</option>
                                    <option value="sait-protiv-sotssetey">‚öñÔ∏è –°–∞–π—Ç –ø—Ä–æ—Ç–∏–≤ —Å–æ—Ü—Å–µ—Ç–µ–π</option>
                                    <option value="pwa-dlya-rb-i-rf-preimushestva">üì≤ PWA –¥–ª—è –†–§ –∏ –†–ë</option>
                                    <option value="kogda-vybrat-pwa-a-kogda-native">‚öîÔ∏è PWA –∏–ª–∏ –Ω–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</option>
                                    <option value="seo-protiv-reklamy-chto-vybrat">üìä SEO –ø—Ä–æ—Ç–∏–≤ —Ä–µ–∫–ª–∞–º—ã</option>
                                    <option value="15-prichin-seo-luchshe-reklamy">üìà 15 –ø—Ä–∏—á–∏–Ω –≤—ã–±—Ä–∞—Ç—å SEO</option>
                                    <option value="seo-dlya-prodvizheniya-analiz">üí∞ –ö–∞–∫ SEO –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å</option>
                                    <option value="vazhnost-texpodderzhki-saita">üîß –í–∞–∂–Ω–æ—Å—Ç—å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏</option>
                                </select>
                                <span class="badge">–≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—å—é</span>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <input type="password" id="secretKey" placeholder="–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–∏–∑ .env.local)" value="" style="width: 300px;">
                                <span class="badge">–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
                            </div>

                            <button onclick="sendPostNotification()" id="postBtn" style="background: #10b981; margin-top: 10px;">
                                üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–µ
                            </button>
                            <p class="info" style="margin-top: 10px; font-size: 12px;">
                                ‚ö†Ô∏è –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å NOTIFICATION_SECRET –≤ .env.local
                            </p>
                        </div>
                    </div>

                    <!-- –°–µ–∫—Ü–∏—è 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ VAPID -->
                    <div class="section-divider">
                        <div class="section-title">üîë –°—Ç–∞—Ç—É—Å VAPID –∫–ª—é—á–µ–π</div>
                        <button onclick="checkVapidStatus()" id="vapidBtn" style="background: #6b7280;">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å VAPID</button>
                    </div>

                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                    <div class="status-box">
                        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                        <div id="result">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞...</div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ -->
                    <div class="status-box">
                        <h3>üì¶ –¢–µ–∫—É—â–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏:</h3>
                        <div id="subscriptions">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            `;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫
            refreshSubscriptions();
        }
        
        // ========== –í–°–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° API ==========
        
        const API_URL = '/api/notifications/subscribe';
        const SEND_API_URL = '/api/notifications/send';
        const POST_API_URL = '/api/notifications/post';

        function showResult(data, isError = false) {
            const resultDiv = document.getElementById('result');
            if (resultDiv) {
                resultDiv.innerHTML = `<pre class="${isError ? 'error' : 'success'}">${JSON.stringify(data, null, 2)}</pre>`;
            }
        }

        async function refreshSubscriptions() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                const subsDiv = document.getElementById('subscriptions');
                
                if (subsDiv) {
                    if (data.subscriptions && data.subscriptions.length > 0) {
                        let html = `<p class="success">‚úÖ –í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å–æ–∫: ${data.total}</p>`;
                        data.subscriptions.forEach((sub, index) => {
                            html += `
                                <div class="subscription-item">
                                    <strong>üìå –ü–æ–¥–ø–∏—Å–∫–∞ #${index + 1}</strong><br>
                                    <span class="info">Endpoint: ${sub.endpoint.substring(0, 70)}...<br>
                                    üìÖ –°–æ–∑–¥–∞–Ω–æ: ${new Date(sub.createdAt).toLocaleString()}<br>
                                    üåê User Agent: ${sub.userAgent || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</span>
                                </div>
                            `;
                        });
                        subsDiv.innerHTML = html;
                    } else {
                        subsDiv.innerHTML = '<p class="info">‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫</p>';
                    }
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫:', err);
            }
        }

        async function testSubscribe() {
            const btn = document.getElementById('subscribeBtn');
            if (btn) btn.disabled = true;
            showResult('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏...');

            try {
                const testData = {
                    endpoint: 'https://example.com/test-endpoint-' + Math.random().toString(36).substring(7),
                    keys: {
                        p256dh: 'test-key-' + Math.random().toString(36).substring(7),
                        auth: 'test-auth-' + Math.random().toString(36).substring(7)
                    }
                };

                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });

                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
                
                if (res.ok) {
                    await refreshSubscriptions();
                }
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        async function testGetSubscriptions() {
            const btn = document.getElementById('getBtn');
            if (btn) btn.disabled = true;
            showResult('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫...');

            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
                await refreshSubscriptions();
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        async function testDeleteAll() {
            const btn = document.getElementById('deleteBtn');
            if (btn) btn.disabled = true;
            showResult('üîÑ –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫...');

            try {
                const res = await fetch(API_URL, {
                    method: 'DELETE'
                });
                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
                await refreshSubscriptions();
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        async function testSendNotification() {
            const btn = document.getElementById('sendBtn');
            if (btn) btn.disabled = true;
            
            const title = document.getElementById('notifyTitle')?.value || '–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            const body = document.getElementById('notifyBody')?.value || '–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            const url = document.getElementById('notifyUrl')?.value || '/';

            if (!title || !body) {
                showResult({ error: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }, true);
                if (btn) btn.disabled = false;
                return;
            }

            showResult('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è...');

            try {
                const res = await fetch(SEND_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, body, url })
                });

                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        async function testSendAdvanced() {
            const btn = document.getElementById('sendAdvancedBtn');
            if (btn) btn.disabled = true;
            
            const title = document.getElementById('notifyTitle')?.value || '–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            const body = document.getElementById('notifyBody')?.value || '–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            const url = document.getElementById('notifyUrl')?.value || '/';
            const icon = document.getElementById('notifyIcon')?.value || '/icons/icon-192x192.png';

            if (!title || !body) {
                showResult({ error: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }, true);
                if (btn) btn.disabled = false;
                return;
            }

            showResult('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è...');

            try {
                const res = await fetch(SEND_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title,
                        body,
                        url,
                        icon,
                        badge: '/icons/icon-72x72.png',
                        data: {
                            from: 'APSOD',
                            timestamp: new Date().toISOString(),
                            type: 'test_notification'
                        },
                        actions: [
                            {
                                action: 'open',
                                title: 'üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É'
                            },
                            {
                                action: 'close',
                                title: '‚ùå –ó–∞–∫—Ä—ã—Ç—å'
                            }
                        ]
                    })
                });

                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        async function testSendToAll() {
            const btn = document.getElementById('sendAllBtn');
            if (btn) btn.disabled = true;
            
            const title = document.getElementById('notifyTitle')?.value || '–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            const body = document.getElementById('notifyBody')?.value || '–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            const url = document.getElementById('notifyUrl')?.value || '/';

            if (!title || !body) {
                showResult({ error: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' }, true);
                if (btn) btn.disabled = false;
                return;
            }

            showResult('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º...');

            try {
                const res = await fetch(SEND_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title + ' (–≤—Å–µ–º)',
                        body,
                        url,
                        icon: '/icons/icon-192x192.png'
                    })
                });

                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        async function sendPostNotification() {
            const slug = document.getElementById('postSlug')?.value;
            const secret = document.getElementById('secretKey')?.value;

            if (!slug) {
                showResult({ error: '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—å—é' }, true);
                return;
            }

            if (!secret) {
                showResult({ error: '–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á' }, true);
                return;
            }

            const btn = document.getElementById('postBtn');
            if (btn) btn.disabled = true;
            showResult('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–µ...');

            try {
                const res = await fetch(POST_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${secret}`
                    },
                    body: JSON.stringify({ slug })
                });

                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        async function checkVapidStatus() {
            const btn = document.getElementById('vapidBtn');
            if (btn) btn.disabled = true;
            showResult('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ VAPID –∫–ª—é—á–µ–π...');

            try {
                const res = await fetch(SEND_API_URL);
                const data = await res.json();
                showResult({ status: res.status, statusText: res.statusText, data });
            } catch (err) {
                showResult({ error: err.message }, true);
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        if (checkAccess()) {
            loadMainContent();
        } else {
            showLoginForm();
        }
    </script>
</body>
</html>